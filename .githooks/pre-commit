#!/bin/bash
#
# Pre-commit hook for automatic version management
# Handles lambda function versioning only (backend versioning happens on merge/deploy)
#

set -e

echo "üîç Checking for lambda function changes..."

# Check if we have python3 available
if ! command -v python3 &> /dev/null; then
    echo "‚ö†Ô∏è  Warning: python3 not found. Skipping version management."
    exit 0
fi

# Get the directory where this script is located (should be .githooks)
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
REPO_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)"

# Check for lambda function changes only
LAMBDA_VERSION_MANAGER="$REPO_ROOT/scripts/version_manager.py"
if [ -f "$LAMBDA_VERSION_MANAGER" ]; then
    echo "üìù Checking lambda function changes..."
    if python3 "$LAMBDA_VERSION_MANAGER"; then
        echo "‚úÖ Lambda version management complete"
    else
        echo "‚ö†Ô∏è  Lambda version management failed"
    fi
else
    echo "‚ö†Ô∏è  Lambda version manager not found"
fi

echo "‚ÑπÔ∏è  Backend versioning will happen on merge/deploy via GitHub Actions"
echo "üéâ Pre-commit version management complete!"
exit 0 